@{
    @using Audiology.Data.Models.Enumerations;
    @model Audiology.Web.ViewModels.Songs.SongViewModel
}

<img src="@(Model.SongArtUrl == null ? Model.AlbumCoverUrl : Model.SongArtUrl)" class="img-fluid" style="width: 100%; height: 25rem" alt="Song cover can't be found sorry  :)" />
<hr />
<div class="row">
    <div class="col-md-6">
        <h1>@Model.Name</h1>
        <hr />
        @if (this.User.IsInRole("Artist"))
        {
            <div id="lyrics">If lyrics are not shown here rename your song. Lyrics come from <a href="https://lyrics.ovh/" target="_blank">lirycs.ovh</a>.</div>
        }
        @if (this.User.IsInRole("User"))
        {
            <div id="lyrics">Sent Email to artist to update the lyrics.</div>
        }
    </div>

    <hr />
    <div class="col-md-6 border-left">

        <hr />

        <span>Song description :</span>
        <div>Description goes here</div>

        // favourites

        // Add social media links here

        <h6 class="text-uppercase">"@Model.Name" Track Info:</h6>
        <hr />

        <div class="row justify-content-sm-center">
            <div class="col-sm text-md-center font-weight-lighter">
                <span class="d-block">Primary artist</span>
                <hr />
                <span class="d-block">Album</span>
                <hr />
                <span class="d-block">Producer</span>
                <hr />
                <span class="d-block">Release Date</span>
                <hr />
            </div>

            <div class="col-sm text-md-center">
                <a href="#" class="text-decoration-none"><span class="d-block">@Model.UserUserName</span></a>
                <hr />
                <a href="#" class="text-decoration-none"><span class="d-block">Strassenbande</span></a>
                <hr />
                <span class="d-block">Nikosaaaaaaa</span>
                <hr />
                <span class="d-block">@Model.Year</span>
                <hr />
            </div>

        </div>

        <iframe width="520" height="315"
                src="https://www.youtube.com/embed/YAt60oZ_J-4?controls=1">
        </iframe>
        <hr />

        @if (Model.AlbumId != null)
        {
            <div class="d-block">
                <img src="@Model.AlbumCoverUrl" class="img-thumbnail rounded float-left" style="width: 7rem; height: 7rem;" alt="Alternate Text" />
                <div class="text-left d-block">
                    <span class="float-sm-right">@Model.AlbumName</span>
                </div>
                <span>@Model.AlbumProducer</span>
                <span>@Model.AlbumReleaseDate</span>
                <span>@Model.AlbumDuration</span>

            </div>

            <hr />
            <div><vc:songs-by-album album-id="@Model.AlbumId"></vc:songs-by-album></div>
        }


    <form enctype="multipart/form-data" asp-controller="Songs" asp-action="Edit" id="updateForm" style="display: none">
        <input type="hidden" name="Id" value="@this.Model.Id" />
        <input type="hidden" name="UserUserName" value="@this.Model.UserUserName" />
        <div>
            <label asp-for="Name"></label>
            <input asp-for="Name" class="form-control" />
            <span asp-validation-for="Name" class="text-danger"></span>
        </div>
        <div>
            <label asp-for="SongArtUrl"></label>
            <input asp-for="SongArtUrl" class="form-control" />
            <span asp-validation-for="SongArtUrl" class="text-danger"></span>
        </div>
        <div>
            <label asp-for="Description"></label>
            <input asp-for="Description" class="form-control" />
            <span asp-validation-for="Description" class="text-danger"></span>
        </div>
        @if (Model.Albums != null)
        {
            <div>
                <label asp-for="AlbumId"></label>
                <select asp-for="AlbumId" asp-items="@Model.Albums.Select(x=> new SelectListItem(x.Name, x.Id.ToString()))" class="form-control">
                    <option value="" selected disabled hidden>Select from existing albums</option>
                    <option value=""></option>
                </select>
                <span asp-validation-for="AlbumId" class="text-danger"></span>
            </div>
        }

        <div>
            <label asp-for="Genre"></label>
            <select class="form-control" asp-for="Genre" asp-items="Html.GetEnumSelectList<Genre>()">
            </select>
            <span asp-validation-for="Genre" class="text-danger"></span>
        </div>
        <div>
            <label asp-for="Year"></label>
            <input asp-for="Year" class="form-control" />
            <span asp-validation-for="Year" class="text-danger"></span>
        </div>
        <div>
            <label asp-for="Producer"></label>
            <input asp-for="Producer" class="form-control" />
            <span asp-validation-for="Producer" class="text-danger"></span>
        </div>

        <hr />
        <button asp-controller="Songs" asp-action="Edit" type="submit" class="btn btn-dark btn-lg btn-block">UPDATE</button>
    </form>
        <br/>
        <a href="#" onclick="toggleForm()" class="btn btn-dark btn-lg btn-block">EDIT SONG</a>

    </div>
    <!-- <div>
        <vc:newest-songs></vc:newest-songs>
    </div> -->
</div>
<div class="fixed-bottom" style="margin-left: 17rem; width: 71rem;">
    <div class="font-weight-lighter text-left" style="margin-left: 1rem;">@Model.Name</div>

    <audio id="player" controls style="width: 100%;">
        <source src="~/Songs/@this.Model.UserUserName/@(Model.Name).mp3" type="audio/mp3"> <!-- Fix extension and type -->
    </audio>
</div>
<h1>text after the view component</h1>
// Big song player , next to him more songs from the same album if there's any and below song lyrics


@section Scripts{
    <script>
        function toggleForm() {
            $('#updateForm').show();
            $([document.documentElement, document.body]).animate({
                scrollTop: $("#updateForm").offset().top
            }, 500);
        }

        $(document).ready (function() {
            var artist = '@Model.UserUserName';
            var song = '@Model.Name';

            $.get("https://api.lyrics.ovh/v1/" + artist + "/" + song ,

                function (data) {
                    if (data.hasOwnProperty('error') == true) {
                    document.getElementById("lyrics").innerHTML = "Lyrics cannot be found";
                    }
                    else {
                    document.getElementById("lyrics").innerHTML = data.lyrics.replace(new RegExp("\n","g"), "<br>");
                    }

                })
        });
    </script>
}
